<?xml version="1.0" encoding="UTF-8"?>
<!-- Created with Jaspersoft Studio version 6.20.0.final using JasperReports Library version 6.20.0-2bc7ab61c56f459e8176eb05c7705e145cd400ad  -->
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="Blank_A4" pageWidth="595" pageHeight="842" columnWidth="595" leftMargin="0" rightMargin="0" topMargin="0" bottomMargin="0" uuid="8fda7b04-1e7a-4ac4-953c-a51082c0550b">
	<property name="com.jaspersoft.studio.unit." value="pixel"/>
	<property name="com.jaspersoft.studio.unit.pageHeight" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.pageWidth" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.topMargin" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.bottomMargin" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.leftMargin" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.rightMargin" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.columnWidth" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.columnSpacing" value="pixel"/>
	<style name="Style1" isDefault="true" fontName="Times New Roman" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="TNR.TTF" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
	<parameter name="logo" class="java.awt.Image"/>
	<parameter name="userId" class="java.lang.Long"/>
	<parameter name="topicId" class="java.lang.Long"/>
	<queryString>
		<![CDATA[select u.firstname || coalesce(' ' || u.surname || ' ', ' ') || u.lastname as "fullName",
       t.title                                                             as "topicName",
       case
           when a.tutor_mark = 'EXCELLENT' then 5
           when a.tutor_mark = 'GOOD' then 4
           when a.tutor_mark = 'MEDIOCRE' then 3
           when a.tutor_mark = 'FAILED' then 2 end                         as "mark",
       extract(epoch from a.end_date - a.start_date)                       as "timeSeconds",
       task.title                                                          as "taskName"
from "user" u
         inner join attempt a on a.user_id = u.id
    and case
            when a.tutor_mark = 'EXCELLENT' then 5
            when a.tutor_mark = 'GOOD' then 4
            when a.tutor_mark = 'MEDIOCRE' then 3
            when a.tutor_mark = 'FAILED' then 2 end >= 3
    and a.is_last_attempt = true
         inner join topic t on t.id = a.topic_id
         inner join task on task.id = a.task_id
 where t.id = $P{topicId} and u.id = $P{userId} ]]>
	</queryString>
	<field name="fullName" class="java.lang.String"/>
	<field name="topicName" class="java.lang.String"/>
	<field name="taskName" class="java.lang.String"/>
	<field name="mark" class="java.lang.Long"/>
	<field name="timeSeconds" class="java.lang.Long"/>
	<variable name="totalMark" class="java.lang.Long" calculation="Sum">
		<variableExpression><![CDATA[$F{mark}]]></variableExpression>
	</variable>
	<variable name="totalTimeSeconds" class="java.lang.Long" calculation="Sum">
		<variableExpression><![CDATA[$F{timeSeconds}]]></variableExpression>
	</variable>
	<group name="Group1">
		<groupHeader>
			<band height="30">
				<property name="com.jaspersoft.studio.unit.height" value="px"/>
				<staticText>
					<reportElement x="20" y="0" width="400" height="30" uuid="249efa38-e6bc-44ef-ae73-366c5cf39b2a"/>
					<box>
						<topPen lineWidth="0.5"/>
						<leftPen lineWidth="0.5"/>
						<bottomPen lineWidth="0.5"/>
						<rightPen lineWidth="0.5"/>
					</box>
					<textElement textAlignment="Center" verticalAlignment="Middle"/>
					<text><![CDATA[Задание]]></text>
				</staticText>
				<staticText>
					<reportElement x="420" y="0" width="55" height="30" uuid="da386457-eeb1-45f9-b92c-53c16e188f94"/>
					<box>
						<topPen lineWidth="0.5"/>
						<leftPen lineWidth="0.5"/>
						<bottomPen lineWidth="0.5"/>
						<rightPen lineWidth="0.5"/>
					</box>
					<textElement textAlignment="Center" verticalAlignment="Middle"/>
					<text><![CDATA[Балл]]></text>
				</staticText>
				<staticText>
					<reportElement x="475" y="0" width="100" height="30" uuid="d1819e1c-1ce9-47c0-ab53-4643d47cf62e"/>
					<box>
						<topPen lineWidth="0.5"/>
						<leftPen lineWidth="0.5"/>
						<bottomPen lineWidth="0.5"/>
						<rightPen lineWidth="0.5"/>
					</box>
					<textElement textAlignment="Center" verticalAlignment="Middle"/>
					<text><![CDATA[Время выполнения в минутах]]></text>
				</staticText>
			</band>
		</groupHeader>
		<groupFooter>
			<band height="50">
				<staticText>
					<reportElement x="20" y="0" width="400" height="30" uuid="f9c4798d-1e3c-4827-be73-352d137a9d71"/>
					<box rightPadding="4">
						<topPen lineWidth="0.5"/>
						<leftPen lineWidth="0.5"/>
						<bottomPen lineWidth="0.5"/>
						<rightPen lineWidth="0.5"/>
					</box>
					<textElement textAlignment="Right" verticalAlignment="Middle"/>
					<text><![CDATA[Суммарно:]]></text>
				</staticText>
				<textField textAdjust="ScaleFont">
					<reportElement x="420" y="0" width="55" height="30" uuid="bfd296a7-185f-4a03-a880-aa533928c6d8"/>
					<box>
						<topPen lineWidth="0.5"/>
						<leftPen lineWidth="0.5"/>
						<bottomPen lineWidth="0.5"/>
						<rightPen lineWidth="0.5"/>
					</box>
					<textElement textAlignment="Center" verticalAlignment="Middle"/>
					<textFieldExpression><![CDATA[$V{totalMark}]]></textFieldExpression>
				</textField>
				<textField textAdjust="ScaleFont">
					<reportElement x="475" y="0" width="100" height="30" uuid="16197380-821a-49f9-baa8-e4fdef56134c"/>
					<box>
						<topPen lineWidth="0.5"/>
						<leftPen lineWidth="0.5"/>
						<bottomPen lineWidth="0.5"/>
						<rightPen lineWidth="0.5"/>
					</box>
					<textElement textAlignment="Center" verticalAlignment="Middle"/>
					<textFieldExpression><![CDATA[java.util.Optional.ofNullable($V{totalTimeSeconds})
.map(r -> {
	long minutes = r / 60;
        long seconds = r % 60;
        String result = "";
        if (minutes > 0) {
            result = "%s мин. ".formatted(minutes);
        }
        result += "%s сек.".formatted(seconds);
        return result;
}).orElse(null)]]></textFieldExpression>
				</textField>
			</band>
		</groupFooter>
	</group>
	<background>
		<band height="842" splitType="Stretch">
			<property name="com.jaspersoft.studio.unit.height" value="px"/>
			<image hAlign="Center" vAlign="Middle">
				<reportElement x="425" y="0" width="150" height="60" uuid="1f92af78-2117-4334-9422-2660587a57ec">
					<property name="com.jaspersoft.studio.unit.width" value="px"/>
					<property name="com.jaspersoft.studio.unit.x" value="px"/>
				</reportElement>
				<imageExpression><![CDATA[$P{logo}]]></imageExpression>
			</image>
		</band>
	</background>
	<title>
		<band height="150">
			<property name="com.jaspersoft.studio.unit.height" value="px"/>
			<staticText>
				<reportElement x="425" y="20" width="150" height="60" uuid="02d7f90e-3fc1-4801-a064-b82f6522bd72">
					<property name="com.jaspersoft.studio.unit.width" value="px"/>
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
				</reportElement>
				<text><![CDATA[]]></text>
			</staticText>
			<staticText>
				<reportElement style="Style1" x="0" y="20" width="424" height="50" uuid="fb485582-2b03-4647-b0d1-c8f92f48b6e7"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Times New Roman" size="25" isBold="true" isItalic="false"/>
				</textElement>
				<text><![CDATA[ПРИЛОЖЕНИЕ К ДИПЛОМУ]]></text>
			</staticText>
			<staticText>
				<reportElement style="Style1" x="20" y="117" width="230" height="19" uuid="74f35675-a58f-4912-94f8-1f3492b948c8">
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
				</reportElement>
				<textElement textAlignment="Left" verticalAlignment="Top">
					<font fontName="Times New Roman" size="16" isBold="true" isItalic="false"/>
				</textElement>
				<text><![CDATA[Образовательная программа:]]></text>
			</staticText>
			<textField textAdjust="ScaleFont">
				<reportElement style="Style1" x="254" y="117" width="296" height="19" uuid="9f083ced-1d48-43dc-ad7c-311ff2b5d91d">
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
				</reportElement>
				<textElement textAlignment="Left" verticalAlignment="Top">
					<font fontName="Times New Roman" size="16" isBold="true" isItalic="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{topicName}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement style="Style1" x="20" y="95" width="159" height="19" uuid="4a467f6a-7c3a-453c-a76c-609f131cee10">
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
				</reportElement>
				<textElement textAlignment="Left" verticalAlignment="Top">
					<font fontName="Times New Roman" size="16" isBold="true" isItalic="false"/>
				</textElement>
				<text><![CDATA[Владелец диплома:]]></text>
			</staticText>
			<textField textAdjust="ScaleFont">
				<reportElement style="Style1" x="184" y="95" width="366" height="19" uuid="51c7e6dc-0212-4957-8b84-5fbbc9514561">
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
				</reportElement>
				<textElement textAlignment="Left" verticalAlignment="Top">
					<font fontName="Times New Roman" size="16" isBold="true" isItalic="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{fullName}]]></textFieldExpression>
			</textField>
		</band>
	</title>
	<pageHeader>
		<band height="88">
			<property name="com.jaspersoft.studio.unit.height" value="px"/>
			<printWhenExpression><![CDATA[$V{REPORT_COUNT} > 0]]></printWhenExpression>
			<staticText>
				<reportElement x="425" y="20" width="150" height="60" uuid="e2615826-6cad-463d-8ed9-89085a4bc317">
					<property name="com.jaspersoft.studio.unit.width" value="px"/>
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
					<property name="com.jaspersoft.studio.unit.x" value="px"/>
				</reportElement>
				<text><![CDATA[]]></text>
			</staticText>
		</band>
	</pageHeader>
	<detail>
		<band height="15" splitType="Stretch">
			<property name="com.jaspersoft.studio.unit.height" value="px"/>
			<textField textAdjust="StretchHeight">
				<reportElement stretchType="ContainerHeight" x="20" y="0" width="400" height="15" uuid="5b65250d-0498-4ac5-bbdb-c6e2ae4b6a7f">
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
				</reportElement>
				<box>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{taskName}]]></textFieldExpression>
			</textField>
			<textField textAdjust="StretchHeight">
				<reportElement stretchType="ContainerHeight" x="420" y="0" width="55" height="15" uuid="ed27b6ee-a2d0-4d43-acfe-8b32e8c96aa5">
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
				</reportElement>
				<box>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{mark}]]></textFieldExpression>
			</textField>
			<textField textAdjust="StretchHeight">
				<reportElement stretchType="ContainerHeight" x="475" y="0" width="100" height="15" uuid="91f8eaa5-1db3-412f-b988-ba5055eca344">
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
				</reportElement>
				<box>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[java.util.Optional.ofNullable($F{timeSeconds})
.map(r -> {
	long minutes = r / 60;
        long seconds = r % 60;
        String result = "";
        if (minutes > 0) {
            result = "%s мин. ".formatted(minutes);
        }
        result += "%s сек.".formatted(seconds);
        return result;
}).orElse(null)]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<pageFooter>
		<band height="25">
			<staticText>
				<reportElement x="470" y="4" width="20" height="18" uuid="e8986cc4-3c11-49a8-bfbf-62c06f928f22"/>
				<textElement verticalAlignment="Middle"/>
				<text><![CDATA[стр.]]></text>
			</staticText>
			<staticText>
				<reportElement x="520" y="4" width="20" height="18" uuid="c47327f7-27b7-4ead-ba63-64f0536bd9f0"/>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<text><![CDATA[из]]></text>
			</staticText>
			<textField textAdjust="ScaleFont">
				<reportElement x="490" y="4" width="30" height="18" uuid="dde01576-d776-49af-975f-de126456430f"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$V{PAGE_NUMBER}]]></textFieldExpression>
			</textField>
			<textField textAdjust="ScaleFont" evaluationTime="Report">
				<reportElement x="540" y="4" width="30" height="18" uuid="86c4bf2f-2c62-4e2a-9dc9-52ef948fba26"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$V{PAGE_NUMBER}]]></textFieldExpression>
			</textField>
		</band>
	</pageFooter>
</jasperReport>
